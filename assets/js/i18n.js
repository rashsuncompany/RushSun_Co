// Inline translations - works without server
const INLINE_TRANSLATIONS = {
    en: {
        nav_home: 'Home',
        nav_about: 'About Us',
        nav_services: 'Services',
        nav_portfolio: 'Portfolio',
        nav_contact: 'Contact',
        hero_title: 'Custom AI Solutions for Your Business',
        hero_subtitle: 'We specialize in IoT, AI, ML, DL, and cutting-edge technology solutions',
        hero_cta: 'Get Started',
        hero_view_work: 'View Our Work',
        about_title: 'About RushSun',
        about_subtitle: 'Your Technology Partner',
        about_description: 'We are a leading technology company specializing in custom AI development, IoT solutions, Machine Learning, Deep Learning, and advanced programming services. Our team of experts delivers innovative solutions tailored to your business needs.',
        services_title: 'Our Services',
        services_subtitle: 'What We Offer',
        service_ai: 'Custom AI Development',
        service_ai_desc: 'Tailored artificial intelligence solutions including chatbots, AI assistants, and intelligent automation systems',
        service_iot: 'IoT Solutions',
        service_iot_desc: 'Smart connected devices, sensor networks, and IoT platforms for smart homes, cities, and industrial automation',
        service_ml: 'Machine Learning',
        service_ml_desc: 'ML models for prediction, classification, clustering, and data analysis with Python, TensorFlow, and scikit-learn',
        service_dl: 'Deep Learning',
        service_dl_desc: 'CNN, RNN, GAN architectures for image recognition, NLP, computer vision, and advanced AI applications',
        service_software: 'Software Development',
        service_software_desc: 'Web applications, APIs, mobile apps, and enterprise software solutions with modern frameworks and technologies',
        service_nlp: 'Natural Language Processing',
        service_nlp_desc: 'Text analysis, sentiment analysis, language translation, chatbots, and NLP-powered applications',
        service_data: 'Data Science & Analytics',
        service_data_desc: 'Data mining, statistical analysis, business intelligence dashboards, and data-driven decision making solutions',
        service_api: 'API Development',
        service_api_desc: 'RESTful APIs, GraphQL, microservices architecture, and API integration for seamless system connectivity',
        service_consulting: 'AI Consulting',
        service_consulting_desc: 'Strategic AI consulting, technology assessment, digital transformation, and AI implementation roadmaps',
        portfolio_title: 'Our Portfolio',
        portfolio_subtitle: 'Showcasing Excellence',
        portfolio_view: 'View Project',
        project_technologies: 'Technologies',
        project_tags: 'Tags',
        view_demo: 'View Demo',
        view_code: 'View Code',
        portfolio_more: 'Load More',
        portfolio_1_title: 'AI-Powered Analytics Platform',
        portfolio_1_desc: 'Advanced analytics solution with machine learning capabilities',
        portfolio_2_title: 'Smart IoT Monitoring System',
        portfolio_2_desc: 'Real-time monitoring and control system for industrial IoT',
        portfolio_3_title: 'Deep Learning Image Recognition',
        portfolio_3_desc: 'Custom image recognition system using deep neural networks',
        portfolio_4_title: 'Predictive Maintenance System',
        portfolio_4_desc: 'ML-based predictive analytics for equipment maintenance',
        portfolio_5_title: 'Natural Language Processing',
        portfolio_5_desc: 'Custom NLP solution for text analysis and understanding',
        portfolio_6_title: 'Automated Recommendation Engine',
        portfolio_6_desc: 'Intelligent recommendation system powered by ML algorithms',
        contact_title: 'Get In Touch',
        contact_subtitle: 'Let\'s Work Together',
        contact_name: 'Your Name',
        contact_email: 'Your Email',
        contact_message: 'Your Message',
        contact_send: 'Send Message',
        contact_success: 'Thank you! We\'ll get back to you soon.',
        contact_address: 'Address',
        contact_address_value: 'Milan, Italy',
        contact_address_value2: 'Tehran, Iran',
        contact_phone: 'Phone',
        contact_email_label: 'Email',
        footer_description: 'Leading technology company specializing in AI, IoT, ML, and DL solutions.',
        footer_quick_links: 'Quick Links',
        footer_contact_info: 'Contact Information',
        footer_rights: 'All rights reserved.',
        stat_projects: 'Projects',
        stat_clients: 'Clients',
        stat_years: 'Years Experience',
        stat_satisfaction: 'Satisfaction%',
        feature_innovation: 'Innovation First',
        feature_excellence: 'Excellence Driven',
        feature_quality: 'Quality Focused',
        whatsapp_iran: 'WhatsApp Iran',
        whatsapp_italy: 'WhatsApp Italy',
        experience_title: 'Team Professional Experience',
        experience_subtitle: 'Enterprise-Level Expertise',
        experience_description: 'Our team members bring extensive experience from leading technology companies, contributing to large-scale enterprise solutions.',
        experience_role: 'Role',
        experience_period: 'Period',
        experience_technologies: 'Technologies & Skills',
        experience_project_type: 'Project Type',
        experience_enterprise: 'Enterprise Solutions',
        experience_cybersecurity: 'Cybersecurity Solutions',
        experience_iot: 'IoT Solutions',
        experience_fullstack: 'Full-Stack Development',
        experience_details: 'Details',
        experience_team_member: 'Team Member'
    },
    fa: {
        nav_home: 'خانه',
        nav_about: 'درباره ما',
        nav_services: 'خدمات',
        nav_portfolio: 'نمونه کارها',
        nav_contact: 'تماس با ما',
        hero_title: 'راهکارهای هوش مصنوعی اختصاصی برای کسب و کار شما',
        hero_subtitle: 'ما در IoT، هوش مصنوعی، یادگیری ماشین، یادگیری عمیق و راهکارهای تکنولوژی پیشرفته تخصص داریم',
        hero_cta: 'شروع کنید',
        hero_view_work: 'مشاهده نمونه کارها',
        about_title: 'درباره راشسان',
        about_subtitle: 'شریک تکنولوژی شما',
        about_description: 'ما یک شرکت پیشرو در زمینه تکنولوژی هستیم که در توسعه هوش مصنوعی اختصاصی، راهکارهای اینترنت اشیا، یادگیری ماشین، یادگیری عمیق و خدمات برنامه نویسی پیشرفته تخصص داریم. تیم متخصصان ما راهکارهای نوآورانه متناسب با نیازهای کسب و کار شما ارائه می‌دهد.',
        services_title: 'خدمات ما',
        services_subtitle: 'آنچه ارائه می‌دهیم',
        service_ai: 'توسعه هوش مصنوعی اختصاصی',
        service_ai_desc: 'راهکارهای هوش مصنوعی شامل چت‌بات‌ها، دستیاران هوشمند و سیستم‌های اتوماسیون هوشمند',
        service_iot: 'راهکارهای اینترنت اشیا',
        service_iot_desc: 'دستگاه‌های متصل هوشمند، شبکه‌های حسگر و پلتفرم‌های IoT برای خانه‌ها و شهرهای هوشمند و اتوماسیون صنعتی',
        service_ml: 'یادگیری ماشین',
        service_ml_desc: 'مدل‌های ML برای پیش‌بینی، طبقه‌بندی، خوشه‌بندی و تحلیل داده با Python، TensorFlow و scikit-learn',
        service_dl: 'یادگیری عمیق',
        service_dl_desc: 'معماری‌های CNN، RNN، GAN برای تشخیص تصویر، NLP، بینایی کامپیوتر و کاربردهای پیشرفته AI',
        service_software: 'توسعه نرم افزار',
        service_software_desc: 'اپلیکیشن‌های وب، API ها، اپلیکیشن‌های موبایل و راهکارهای نرم افزاری سازمانی با فریم‌ورک‌ها و تکنولوژی‌های مدرن',
        service_nlp: 'پردازش زبان طبیعی',
        service_nlp_desc: 'تحلیل متن، تحلیل احساسات، ترجمه زبان، چت‌بات‌ها و اپلیکیشن‌های مبتنی بر NLP',
        service_data: 'علم داده و تحلیل',
        service_data_desc: 'داده‌کاوی، تحلیل آماری، داشبوردهای هوش کسب و کار و راهکارهای تصمیم‌گیری داده‌محور',
        service_api: 'توسعه API',
        service_api_desc: 'RESTful APIs، GraphQL، معماری میکروسرویس و یکپارچه‌سازی API برای اتصال بدون وقفه سیستم‌ها',
        service_consulting: 'مشاوره هوش مصنوعی',
        service_consulting_desc: 'مشاوره استراتژیک AI، ارزیابی تکنولوژی، تحول دیجیتال و نقشه راه پیاده‌سازی AI',
        portfolio_title: 'نمونه کارهای ما',
        portfolio_subtitle: 'نمایش تعالی',
        portfolio_view: 'مشاهده پروژه',
        project_technologies: 'تکنولوژی‌ها',
        project_tags: 'برچسب‌ها',
        view_demo: 'مشاهده دمو',
        view_code: 'مشاهده کد',
        portfolio_more: 'بیشتر',
        portfolio_1_title: 'پلتفرم تحلیل هوش مصنوعی',
        portfolio_1_desc: 'راهکار تحلیل پیشرفته با قابلیت‌های یادگیری ماشین',
        portfolio_2_title: 'سیستم نظارت هوشمند اینترنت اشیا',
        portfolio_2_desc: 'سیستم نظارت و کنترل آنی برای اینترنت اشیای صنعتی',
        portfolio_3_title: 'تشخیص تصویر با یادگیری عمیق',
        portfolio_3_desc: 'سیستم تشخیص تصویر سفارشی با استفاده از شبکه‌های عصبی عمیق',
        portfolio_4_title: 'سیستم نگهداری پیش‌بینانه',
        portfolio_4_desc: 'تحلیل پیش‌بینانه مبتنی بر ML برای نگهداری تجهیزات',
        portfolio_5_title: 'پردازش زبان طبیعی',
        portfolio_5_desc: 'راهکار NLP سفارشی برای تحلیل و درک متن',
        portfolio_6_title: 'موتور پیشنهاد خودکار',
        portfolio_6_desc: 'سیستم پیشنهاد هوشمند با استفاده از الگوریتم‌های ML',
        contact_title: 'تماس با ما',
        contact_subtitle: 'بیایید با هم کار کنیم',
        contact_name: 'نام شما',
        contact_email: 'ایمیل شما',
        contact_message: 'پیام شما',
        contact_send: 'ارسال پیام',
        contact_success: 'متشکریم! به زودی با شما تماس خواهیم گرفت.',
        contact_address: 'آدرس',
        contact_address_value: 'میلان، ایتالیا',
        contact_address_value2: 'تهران، ایران',
        contact_phone: 'تلفن',
        contact_email_label: 'ایمیل',
        footer_description: 'شرکت پیشرو در زمینه تکنولوژی متخصص در راهکارهای هوش مصنوعی، اینترنت اشیا، یادگیری ماشین و یادگیری عمیق.',
        footer_quick_links: 'لینک‌های سریع',
        footer_contact_info: 'اطلاعات تماس',
        footer_rights: 'تمام حقوق محفوظ است.',
        stat_projects: 'پروژه',
        stat_clients: 'مشتری',
        stat_years: 'سال تجربه',
        stat_satisfaction: 'رضایت%',
        feature_innovation: 'اول نوآوری',
        feature_excellence: 'هدایت شده با تعالی',
        feature_quality: 'متمرکز بر کیفیت',
        whatsapp_iran: 'واتس‌اپ ایران',
        whatsapp_italy: 'واتس‌اپ ایتالیا',
        experience_title: 'تجربه حرفه‌ای تیم',
        experience_subtitle: 'تخصص در سطح سازمانی',
        experience_description: 'اعضای تیم ما تجربه گسترده‌ای از شرکت‌های پیشرو در زمینه تکنولوژی دارند و در راهکارهای سازمانی در مقیاس بزرگ مشارکت داشته‌اند.',
        experience_role: 'نقش',
        experience_period: 'دوره',
        experience_technologies: 'تکنولوژی‌ها و مهارت‌ها',
        experience_project_type: 'نوع پروژه',
        experience_enterprise: 'راهکارهای سازمانی',
        experience_cybersecurity: 'راهکارهای امنیت سایبری',
        experience_iot: 'راهکارهای اینترنت اشیا',
        experience_fullstack: 'توسعه فول‌استک',
        experience_details: 'جزئیات',
        experience_team_member: 'عضو تیم'
    },
    it: {
        nav_home: 'Home',
        nav_about: 'Chi Siamo',
        nav_services: 'Servizi',
        nav_portfolio: 'Portfolio',
        nav_contact: 'Contatti',
        hero_title: 'Soluzioni AI Personalizzate per la Tua Azienda',
        hero_subtitle: 'Ci specializziamo in IoT, AI, ML, DL e soluzioni tecnologiche all\'avanguardia',
        hero_cta: 'Inizia',
        hero_view_work: 'Vedi i Nostri Lavori',
        about_title: 'Chi Siamo RushSun',
        about_subtitle: 'Il Tuo Partner Tecnologico',
        about_description: 'Siamo un\'azienda tecnologica leader specializzata nello sviluppo di AI personalizzate, soluzioni IoT, Machine Learning, Deep Learning e servizi di programmazione avanzata. Il nostro team di esperti offre soluzioni innovative su misura per le esigenze della tua azienda.',
        services_title: 'I Nostri Servizi',
        services_subtitle: 'Cosa Offriamo',
        service_ai: 'Sviluppo AI Personalizzato',
        service_ai_desc: 'Soluzioni di intelligenza artificiale personalizzate inclusi chatbot, assistenti AI e sistemi di automazione intelligente',
        service_iot: 'Soluzioni IoT',
        service_iot_desc: 'Dispositivi connessi intelligenti, reti di sensori e piattaforme IoT per smart home, smart city e automazione industriale',
        service_ml: 'Machine Learning',
        service_ml_desc: 'Modelli ML per previsione, classificazione, clustering e analisi dati con Python, TensorFlow e scikit-learn',
        service_dl: 'Deep Learning',
        service_dl_desc: 'Architetture CNN, RNN, GAN per riconoscimento immagini, NLP, computer vision e applicazioni AI avanzate',
        service_software: 'Sviluppo Software',
        service_software_desc: 'Applicazioni web, API, app mobili e soluzioni software enterprise con framework e tecnologie moderne',
        service_nlp: 'Elaborazione del Linguaggio Naturale',
        service_nlp_desc: 'Analisi del testo, analisi del sentiment, traduzione linguistica, chatbot e applicazioni basate su NLP',
        service_data: 'Data Science & Analytics',
        service_data_desc: 'Data mining, analisi statistica, dashboard di business intelligence e soluzioni di decision-making basate sui dati',
        service_api: 'Sviluppo API',
        service_api_desc: 'API RESTful, GraphQL, architettura microservizi e integrazione API per connettività di sistema senza interruzioni',
        service_consulting: 'Consulenza AI',
        service_consulting_desc: 'Consulenza strategica AI, valutazione tecnologica, trasformazione digitale e roadmap di implementazione AI',
        portfolio_title: 'Il Nostro Portfolio',
        portfolio_subtitle: 'Mostrare l\'Eccellenza',
        portfolio_view: 'Vedi Progetto',
        project_technologies: 'Tecnologie',
        project_tags: 'Tag',
        view_demo: 'Visualizza Demo',
        view_code: 'Visualizza Codice',
        portfolio_more: 'Carica Altri',
        portfolio_1_title: 'Piattaforma Analytics Powered by AI',
        portfolio_1_desc: 'Soluzione analytics avanzata con capacità di machine learning',
        portfolio_2_title: 'Sistema di Monitoraggio IoT Intelligente',
        portfolio_2_desc: 'Sistema di monitoraggio e controllo in tempo reale per IoT industriale',
        portfolio_3_title: 'Riconoscimento Immagini Deep Learning',
        portfolio_3_desc: 'Sistema di riconoscimento immagini personalizzato usando reti neurali profonde',
        portfolio_4_title: 'Sistema di Manutenzione Predittiva',
        portfolio_4_desc: 'Analytics predittive basate su ML per la manutenzione delle apparecchiature',
        portfolio_5_title: 'Elaborazione del Linguaggio Naturale',
        portfolio_5_desc: 'Soluzione NLP personalizzata per l\'analisi e la comprensione del testo',
        portfolio_6_title: 'Motore di Raccomandazione Automatico',
        portfolio_6_desc: 'Sistema di raccomandazione intelligente alimentato da algoritmi ML',
        contact_title: 'Mettiti in Contatto',
        contact_subtitle: 'Lavoriamo Insieme',
        contact_name: 'Il Tuo Nome',
        contact_email: 'La Tua Email',
        contact_message: 'Il Tuo Messaggio',
        contact_send: 'Invia Messaggio',
        contact_success: 'Grazie! Ti risponderemo presto.',
        contact_address: 'Indirizzo',
        contact_address_value: 'Milano, Italia',
        contact_address_value2: 'Tehran, Iran',
        contact_phone: 'Telefono',
        contact_email_label: 'Email',
        footer_description: 'Azienda tecnologica leader specializzata in soluzioni AI, IoT, ML e DL.',
        footer_quick_links: 'Link Rapidi',
        footer_contact_info: 'Informazioni di Contatto',
        footer_rights: 'Tutti i diritti riservati.',
        stat_projects: 'Progetti',
        stat_clients: 'Clienti',
        stat_years: 'Anni di Esperienza',
        stat_satisfaction: 'Soddisfazione%',
        feature_innovation: 'Prima l\'Innovazione',
        feature_excellence: 'Guidati dall\'Eccellenza',
        feature_quality: 'Focalizzati sulla Qualità',
        whatsapp_iran: 'WhatsApp Iran',
        whatsapp_italy: 'WhatsApp Italia',
        experience_title: 'Esperienza Professionale del Team',
        experience_subtitle: 'Competenze di Livello Enterprise',
        experience_description: 'I membri del nostro team portano un\'esperienza estesa da aziende tecnologiche leader, contribuendo a soluzioni enterprise su larga scala.',
        experience_role: 'Ruolo',
        experience_period: 'Periodo',
        experience_technologies: 'Tecnologie e Competenze',
        experience_project_type: 'Tipo di Progetto',
        experience_enterprise: 'Soluzioni Enterprise',
        experience_cybersecurity: 'Soluzioni di Cybersecurity',
        experience_iot: 'Soluzioni IoT',
        experience_fullstack: 'Sviluppo Full-Stack',
        experience_details: 'Dettagli',
        experience_team_member: 'Membro del Team'
    }
};

// Internationalization System
class I18n {
    constructor() {
        this.currentLang = localStorage.getItem('language') || 'en';
        this.translations = {};
    }

    async init() {
        try {
            const loaded = await this.loadTranslations(this.currentLang);
            
            if (loaded && Object.keys(this.translations).length > 0) {
                this.applyTranslations();
                this.updateLangSwitcher();
                this.updateDocumentDirection();
            } else {
                console.warn('⚠️ Translations not loaded - displaying default English text');
                // Don't apply translations if they failed to load
                this.updateLangSwitcher();
                this.updateDocumentDirection();
            }
        } catch (error) {
            console.error('Error initializing i18n:', error);
            this.updateLangSwitcher();
            this.updateDocumentDirection();
        }
    }

    async loadTranslations(lang) {
        // First try to use inline translations (works without server)
        if (INLINE_TRANSLATIONS[lang]) {
            this.translations = INLINE_TRANSLATIONS[lang];
            console.log(`✓ Loaded ${Object.keys(this.translations).length} inline translations for language: ${lang}`);
            return true;
        }
        
        // Fallback to API (if running on server)
        try {
            // Check if we're on a server (not file://)
            if (window.location.protocol === 'file:') {
                throw new Error('File protocol detected - using inline translations only');
            }
            
            // Build API URL
            const apiUrl = `api/languages.php?lang=${lang}&t=${Date.now()}`;
            console.log(`Fetching translations from API: ${apiUrl}`);
            
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                },
                cache: 'no-cache'
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data && typeof data === 'object' && !data.error && Object.keys(data).length > 0) {
                this.translations = data;
                console.log(`✓ Loaded ${Object.keys(data).length} translations from API for language: ${lang}`);
                return true;
            } else {
                throw new Error(data.error || 'Invalid or empty translation data');
            }
        } catch (error) {
            console.warn('⚠️ API fetch failed, using inline translations:', error.message);
            // Use inline translations as fallback
            if (INLINE_TRANSLATIONS[lang]) {
                this.translations = INLINE_TRANSLATIONS[lang];
                console.log(`✓ Using inline translations for language: ${lang}`);
                return true;
            }
            this.translations = {};
            return false;
        }
    }

    async switchLanguage(lang) {
        if (lang === this.currentLang) return;
        
        this.currentLang = lang;
        localStorage.setItem('language', lang);
        
        await this.loadTranslations(lang);
        this.applyTranslations();
        this.updateLangSwitcher();
        this.updateDocumentDirection();
        
        // Update URL without reload
        const url = new URL(window.location);
        url.searchParams.set('lang', lang);
        window.history.pushState({}, '', url);
    }

    translate(key) {
        return this.translations[key] || key;
    }

    applyTranslations() {
        let translatedCount = 0;
        let skippedCount = 0;
        
        // Translate all elements with data-translate attribute
        document.querySelectorAll('[data-translate]').forEach(element => {
            const key = element.getAttribute('data-translate');
            if (!key) return;
            
            const translation = this.translate(key);
            
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                // Don't translate input values, only placeholders
            } else {
                // Only update if translation exists and is different from key
                if (translation && translation !== key && this.translations[key]) {
                    element.textContent = translation;
                    translatedCount++;
                } else {
                    // Keep default text if translation not found
                    skippedCount++;
                    console.warn(`Translation not found for key: ${key}`);
                }
            }
        });

        // Translate placeholders
        document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
            const key = element.getAttribute('data-translate-placeholder');
            if (!key) return;
            
            const translation = this.translate(key);
            if (translation && translation !== key && this.translations[key]) {
                element.placeholder = translation;
                translatedCount++;
            } else {
                console.warn(`Placeholder translation not found for key: ${key}`);
            }
        });
        
        console.log(`Applied ${translatedCount} translations, skipped ${skippedCount} elements`);
        
        // If no translations applied, there's a problem
        if (translatedCount === 0 && Object.keys(this.translations).length === 0) {
            console.error('No translations loaded! Check API endpoint and network tab.');
        }
    }

    updateLangSwitcher() {
        document.querySelectorAll('.lang-btn').forEach(btn => {
            const btnLang = btn.getAttribute('data-lang');
            if (btnLang === this.currentLang) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    }

    updateDocumentDirection() {
        const html = document.getElementById('htmlRoot');
        if (this.currentLang === 'fa') {
            html.setAttribute('dir', 'rtl');
            html.setAttribute('lang', 'fa');
        } else {
            html.setAttribute('dir', 'ltr');
            html.setAttribute('lang', this.currentLang);
        }
    }
}

// Initialize i18n when DOM is ready
let i18n;
document.addEventListener('DOMContentLoaded', async () => {
    i18n = new I18n();
    
    // Set default language to English if not set
    if (!localStorage.getItem('language')) {
        localStorage.setItem('language', 'en');
        i18n.currentLang = 'en';
    }
    
    // Check URL parameter for language first
    const urlParams = new URLSearchParams(window.location.search);
    const langParam = urlParams.get('lang');
    if (langParam && ['en', 'fa', 'it'].includes(langParam)) {
        i18n.currentLang = langParam;
        localStorage.setItem('language', langParam);
    } else {
        // Ensure default is English
        i18n.currentLang = localStorage.getItem('language') || 'en';
        localStorage.setItem('language', i18n.currentLang);
    }
    
    // Initialize translations
    await i18n.init();
    
    // Set current year
    const currentYearEl = document.getElementById('currentYear');
    if (currentYearEl) {
        currentYearEl.textContent = new Date().getFullYear();
    }
    
    // Language switcher buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
            e.preventDefault();
            const lang = btn.getAttribute('data-lang');
            await i18n.switchLanguage(lang);
        });
    });
});

// Export for use in other scripts
window.i18n = i18n;

